<Window x:Class="F1Predictor.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
        mc:Ignorable="d"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{DynamicResource MaterialDesignFont}"
        Title="F1 AI Predictor 2025" Height="720" Width="1280"
        WindowState="Maximized" WindowStartupLocation="CenterScreen">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="60"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <materialDesign:ColorZone Mode="PrimaryMid" Padding="16" materialDesign:ShadowAssist.ShadowDepth="Depth3">
            <StackPanel Orientation="Horizontal">
                <TextBlock VerticalAlignment="Center" Margin="16 0 0 0" FontSize="24" FontWeight="Bold" Text="🏁 F1 AI PREDICTOR PRO"/>
            </StackPanel>
        </materialDesign:ColorZone>

        <TabControl Grid.Row="1" Style="{StaticResource MaterialDesignFilledTabControl}" TabStripPlacement="Left">
            
            <TabItem Width="80" Height="80">
                <TabItem.Header>
                    <StackPanel>
                        <TextBlock Text="AI" HorizontalAlignment="Center" FontSize="18" FontWeight="Bold"/>
                        <TextBlock Text="Прогноз" HorizontalAlignment="Center" FontSize="10"/>
                    </StackPanel>
                </TabItem.Header>

                <Grid Margin="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="350"/> <ColumnDefinition Width="*"/>   </Grid.ColumnDefinitions>

                    <materialDesign:Card Padding="20" Margin="0,0,20,0" UniformCornerRadius="10" materialDesign:ShadowAssist.ShadowDepth="Depth2">
                        <StackPanel>
                            <TextBlock Text="Налаштування гонки" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,20"/>

                            <ComboBox x:Name="CircuitCombo" materialDesign:HintAssist.Hint="Оберіть трасу 🌍" 
                                      Style="{StaticResource MaterialDesignFloatingHintComboBox}" Margin="0,0,0,20"
                                      DisplayMemberPath="DisplayName" SelectedValuePath="CircuitId"
                                      IsEditable="True" SelectionChanged="CircuitCombo_SelectionChanged"/>

                            <ComboBox x:Name="DriverCombo" materialDesign:HintAssist.Hint="Оберіть пілота 🏎️" 
                                      Style="{StaticResource MaterialDesignFloatingHintComboBox}" Margin="0,0,0,20"
                                      DisplayMemberPath="FullName" SelectedValuePath="DriverId"
                                      IsEditable="True" SelectionChanged="DriverCombo_SelectionChanged"/>

                            <ComboBox x:Name="TeamCombo" materialDesign:HintAssist.Hint="Оберіть команду 🔧" 
                                      Style="{StaticResource MaterialDesignFloatingHintComboBox}" Margin="0,0,0,20"
                                      DisplayMemberPath="Name" SelectedValuePath="ConstructorId"
                                      IsEditable="True" SelectionChanged="TeamCombo_SelectionChanged"/>
                            <StackPanel Margin="0,10,0,10">
                                <TextBlock Text="Режим аналізу:" Foreground="Gray" FontSize="10" Margin="0,0,0,5"/>
                                <DockPanel>
                                    <TextBlock Text="Загальна форма" VerticalAlignment="Center" Foreground="Gray" FontSize="11"/>
        
                                    <ToggleButton x:Name="TrackFilterToggle" Margin="10,0"
                                                  Style="{StaticResource MaterialDesignSwitchToggleButton}"
                                                  ToolTip="Увімкніть, щоб дивитись статистику тільки для цієї траси"
                                                  Checked="Filter_Changed" Unchecked="Filter_Changed"/>
                      
                                    <TextBlock Text="Тільки ця траса" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryHueMidBrush}" FontWeight="Bold" FontSize="11"/>
                                </DockPanel>
                            </StackPanel>
                            <TextBlock Text="Стартова позиція (Grid)" Margin="0,10,0,5" Foreground="Gray"/>
                            <DockPanel Margin="0,0,0,30">
                                <TextBlock Text="{Binding ElementName=GridSlider, Path=Value}" DockPanel.Dock="Right" FontWeight="Bold" Margin="10,0,0,0" FontSize="16"/>
                                <Slider x:Name="GridSlider" Minimum="1" Maximum="20" Value="1" TickFrequency="1" IsSnapToTickEnabled="True"/>
                            </DockPanel>

                            <Button Content="РОЗРАХУВАТИ ПРОГНОЗ" Height="50" FontSize="16" Click="ButtonPredict_Click"
                                    materialDesign:ButtonAssist.CornerRadius="25"/>
                            
                            <Button Content="Перевірити точність моделі" Margin="0,20,0,0" Style="{StaticResource MaterialDesignOutlinedButton}" Click="ButtonEvaluate_Click"/>
                        </StackPanel>
                    </materialDesign:Card>

                    <Grid Grid.Column="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <materialDesign:Card Grid.Row="0" Margin="0,0,0,20" Padding="20" UniformCornerRadius="10" Background="#252525">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                    
                                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,20,0">
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                        <Border Width="80" Height="80" CornerRadius="40" Background="#333" Margin="0,0,10,0" ClipToBounds="True">
                                            <Image x:Name="DriverPhoto" Stretch="UniformToFill"/>
                                        </Border>
                                        <Border Width="60" Height="60" CornerRadius="10" Background="White" VerticalAlignment="Center">
                                            <Image x:Name="TeamLogo" Stretch="Uniform" Margin="5"/>
                                        </Border>
                                        <Border Width="100" Height="100" CornerRadius="10" Background="Transparent" VerticalAlignment="Center">
                                            <Image x:Name="CircuitImage" Stretch="Uniform"/>
                                        </Border>
                                    </StackPanel>

                                    <materialDesign:Card Padding="10" Background="#303030" UniformCornerRadius="5">
                                        <StackPanel>
                                            <TextBlock Text="Сер. піт-стоп:" Foreground="Gray" FontSize="10"/>
                                            <TextBlock x:Name="PitStopText" Text="---" FontWeight="Bold" Foreground="#FFD700" FontSize="14"/>
                                        </StackPanel>
                                    </materialDesign:Card>
                                    
                                    <materialDesign:Card Padding="10" Background="#303030" UniformCornerRadius="5">
                                        <StackPanel>
                                            <TextBlock Text="Надійність:" Foreground="Gray" FontSize="10" Margin="0,0,0,5"/>
                                            <Grid>
                                                <ProgressBar x:Name="ReliabilityBar" Style="{StaticResource MaterialDesignCircularProgressBar}"
                                                             Value="0" Maximum="100" Width="40" Height="40" Foreground="#4CAF50"/>
                                                <TextBlock x:Name="ReliabilityText" Text="0%" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="10" FontWeight="Bold"/>
                                            </Grid>
                                        </StackPanel>
                                    </materialDesign:Card>
                                </StackPanel>

                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="Прогнозований результат:" Foreground="Gray" FontSize="16"/>
                                    <TextBlock x:Name="ResultText" Text="---" FontSize="48" FontWeight="Bold" Foreground="#FF5252"/>
                                </StackPanel>
                            </Grid>
                        </materialDesign:Card>

                        <materialDesign:Card Grid.Row="1" Padding="20" UniformCornerRadius="10">
                            <StackPanel>
                                <TextBlock Text="Історична аналітика (останні виступи)" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,20"/>
                                <lvc:CartesianChart x:Name="StatsChart" Height="300" Margin="10">
                                    <lvc:CartesianChart.AxisY>
                                        <lvc:Axis Title="Місце на фініші" MinValue="1" MaxValue="20" IsMerged="True">
                                            <lvc:Axis.Separator>
                                                <lvc:Separator Step="1"/>
                                            </lvc:Axis.Separator>
                                        </lvc:Axis>
                                    </lvc:CartesianChart.AxisY>
                                    <lvc:CartesianChart.AxisX>
                                        <lvc:Axis Title="Останні гонки"></lvc:Axis>
                                    </lvc:CartesianChart.AxisX>
                                </lvc:CartesianChart>
                            </StackPanel>
                        </materialDesign:Card>
                    </Grid>
                </Grid>
            </TabItem>

            <TabItem Width="80" Height="80" Selector.Selected="HistoryTab_Selected">
                 <TabItem.Header>
                    <StackPanel>
                        <TextBlock Text="DATA" HorizontalAlignment="Center" FontSize="18" FontWeight="Bold"/>
                        <TextBlock Text="Історія" HorizontalAlignment="Center" FontSize="10"/>
                    </StackPanel>
                </TabItem.Header>

                <Grid Margin="20">
                    <materialDesign:Card Padding="0" UniformCornerRadius="10">
                        <DataGrid x:Name="HistoryGrid" AutoGenerateColumns="False" IsReadOnly="True" 
                                  CanUserAddRows="False" HeadersVisibility="Column"
                                  materialDesign:DataGridAssist.CellPadding="13 8 8 8" 
                                  materialDesign:DataGridAssist.ColumnHeaderPadding="8">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Дата" Binding="{Binding Date, StringFormat=dd.MM HH:mm}" Width="120"/>
                                <DataGridTextColumn Header="Пілот" Binding="{Binding DriverName}" Width="*"/>
                                <DataGridTextColumn Header="Траса" Binding="{Binding CircuitName}" Width="200"/>
                                <DataGridTextColumn Header="Старт" Binding="{Binding GridPosition}" Width="80"/>
                                <DataGridTextColumn Header="Прогноз" Binding="{Binding PredictedPosition, StringFormat=N1}" Width="100" FontWeight="Bold"/>
                                
                                <DataGridTemplateColumn Width="100">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="DEL" Style="{StaticResource MaterialDesignFlatButton}" 
                                                    Foreground="Red" Click="ButtonDelete_Click"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </materialDesign:Card>
                </Grid>
            </TabItem>
            <TabItem Width="80" Height="80">
                <TabItem.Header>
                    <StackPanel>
                        <TextBlock Text="VS" HorizontalAlignment="Center" FontSize="18" FontWeight="Bold"/>
                        <TextBlock Text="Батл" HorizontalAlignment="Center" FontSize="10"/>
                    </StackPanel>
                </TabItem.Header>

                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <RowDefinition Height="*"/>    </Grid.RowDefinitions>

                    <materialDesign:Card Padding="20" UniformCornerRadius="10" Margin="0,0,0,20">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <ComboBox x:Name="DriverACombo" materialDesign:HintAssist.Hint="Пілот A (напр. Hamilton)" 
                                          Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                          DisplayMemberPath="FullName" SelectedValuePath="DriverId"
                                          IsEditable="True"/>
                            </StackPanel>

                            <Button Grid.Column="1" Content="VS" Margin="20,0" Width="60" Height="60"
                                    Style="{StaticResource MaterialDesignFloatingActionDarkButton}"
                                    Click="ButtonCompare_Click" Background="#D32F2F" BorderBrush="#D32F2F"/>

                            <StackPanel Grid.Column="2">
                                <ComboBox x:Name="DriverBCombo" materialDesign:HintAssist.Hint="Пілот B (напр. Schumacher)" 
                                          Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                          DisplayMemberPath="FullName" SelectedValuePath="DriverId"
                                          IsEditable="True"/>
                            </StackPanel>
                        </Grid>
                    </materialDesign:Card>

                    <materialDesign:Card Grid.Row="1" Padding="20" UniformCornerRadius="10">
                        <lvc:CartesianChart x:Name="VsChart" LegendLocation="Bottom">
                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis Labels="Гонки,Перемоги,Подіуми,Поули"></lvc:Axis>
                            </lvc:CartesianChart.AxisX>
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis MinValue="0"></lvc:Axis>
                            </lvc:CartesianChart.AxisY>
                        </lvc:CartesianChart>
                    </materialDesign:Card>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>